<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPortal | NearU</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #4f46e5; --secondary: #f59e0b; --dark: #1e293b; --light: #f8fafc; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--light); color: var(--dark); }
        .hidden { display: none !important; }

        /* Auth Screen */
        #auth-page { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #4f46e5, #7c3aed); }
        .auth-card { background: white; padding: 2.5rem; border-radius: 16px; width: 90%; max-width: 400px; box-shadow: 0 20px 25px rgba(0,0,0,0.15); }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 10px; border: none; cursor: pointer; border-radius: 8px; font-weight: bold; background: #f1f5f9; }
        .tab-btn.active { background: var(--primary); color: white; }
        
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; margin-top: 10px; font-size: 15px; }
        .btn-main { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 15px; transition: 0.3s; }
        .btn-main:hover { opacity: 0.9; transform: translateY(-1px); }

        /* Dashboard */
        nav { background: white; padding: 1rem 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); sticky; top: 0; z-index: 100; }
        .nav-links { display: flex; gap: 20px; list-style: none; align-items: center; }
        .nav-links a { text-decoration: none; color: var(--dark); font-weight: 500; }
        .logout-btn { color: #ef4444 !important; cursor: pointer; border: 1px solid #fee2e2; padding: 5px 12px; border-radius: 6px; }

        .container { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }
        .hero { background: white; padding: 2rem; border-radius: 15px; border-left: 6px solid var(--primary); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        
        .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 2rem 0; }
        .btn-action { padding: 1.5rem; border-radius: 12px; border: none; color: white; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        
        .card { background: white; padding: 1.5rem; border-radius: 12px; margin-top: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .review-item { padding: 10px; border-bottom: 1px solid #f1f5f9; background: #f8fafc; border-radius: 6px; margin-bottom: 10px; }

        @media (max-width: 768px) {
            .action-btns { grid-template-columns: 1fr; }
            .nav-links { display: none; } /* Mobile menu logic can be added here */
        }
    </style>
</head>
<body>

    <div id="auth-page">
        <div class="auth-card">
            <h2 style="text-align: center; margin-bottom: 20px;">EduPortal</h2>
            <div class="tabs">
                <button class="tab-btn active" id="loginTab">Login</button>
                <button class="tab-btn" id="signupTab">Sign Up</button>
            </div>
            <form id="auth-form">
                <input type="text" id="regName" class="hidden" placeholder="Full Name">
                <input type="email" id="email" placeholder="Email Address" required>
                <input type="password" id="password" placeholder="Password" required>
                <select id="roleSelect">
                    <option value="student">Student Account</option>
                    <option value="admin">Admin Account</option>
                </select>
                <input type="password" id="adminKey" class="hidden" placeholder="Admin Secret Key">
                <button type="submit" class="btn-main" id="submitBtn">Sign In</button>
            </form>
            <p id="error-msg" style="color: #ef4444; text-align:center; font-size:13px; margin-top:10px;"></p>
        </div>
    </div>

    <div id="dashboard" class="hidden">
        <nav>
            <div class="logo"><h3 style="color:var(--primary)">NearU Portal</h3></div>
            <ul class="nav-links">
                <li><a href="#">Home</a></li>
                <li><a href="#">Profile</a></li>
                <li><a onclick="logout()" class="logout-btn">Logout</a></li>
            </ul>
        </nav>
        <div class="container" id="main-content">
            <div class="hero">
                <h1 id="userNameDisplay">Welcome!</h1>
                <p id="dateDisplay" style="color:#64748b; margin-top:5px;"></p>
                <p id="quoteDisplay" style="margin-top:15px; font-style:italic; color:#475569;"></p>
            </div>

            <div class="action-btns">
                <button class="btn-action" style="background:var(--primary)" id="viewPyqBtn"><i class="fas fa-file-pdf"></i> View PYQs</button>
                <button class="btn-action" style="background:var(--secondary)"><i class="fas fa-lightbulb"></i> Important Qs</button>
            </div>

            <div class="card">
                <h3>To-Do List</h3>
                <div id="todoList" style="margin-top:10px;">
                    <label style="display:block; margin:5px 0;"><input type="checkbox"> Finish Math Assignment</label>
                    <label style="display:block; margin:5px 0;"><input type="checkbox"> Download Chemistry PYQs</label>
                </div>
            </div>

            <div class="card">
                <h3>Student Reviews</h3>
                <textarea id="reviewInput" placeholder="Share your experience..."></textarea>
                <button class="btn-main" id="postReview" style="width:auto; padding:10px 25px;">Post Review</button>
                <div id="reviewBox" style="margin-top:20px;"></div>
            </div>
        </div>
    </div>

    <div id="admin-panel" class="hidden">
        <nav>
            <div class="logo"><h3>Admin Control</h3></div>
            <a onclick="logout()" class="logout-btn">Logout</a>
        </nav>
        <div class="container">
            <div class="card">
                <h2>Upload New PYQ</h2>
                <input type="text" id="upSubj" placeholder="Subject Name">
                <input type="number" id="upYear" placeholder="Year (e.g. 2024)">
                <select id="upSem">
                    <option>Semester 1</option><option>Semester 2</option>
                    <option>Semester 3</option><option>Semester 4</option>
                </select>
                <input type="file" id="fileInput" style="border:none;">
                <button class="btn-main" id="uploadBtn" style="background:#10b981;">Upload to Firebase</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBwjI1WxObDvOd9v0E7WrB69IwhLX6Uhr4",
            authDomain: "nearu-c2bcd.firebaseapp.com",
            projectId: "nearu-c2bcd",
            storageBucket: "nearu-c2bcd.firebasestorage.app",
            messagingSenderId: "406211381950",
            appId: "1:406211381950:web:008b8d04d618a2c579acef"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // --- AUTH UI LOGIC ---
        const roleSelect = document.getElementById('roleSelect');
        const adminKeyField = document.getElementById('adminKey');
        const loginTab = document.getElementById('loginTab');
        const signupTab = document.getElementById('signupTab');
        let isLogin = true;

        roleSelect.onchange = () => adminKeyField.classList.toggle('hidden', roleSelect.value !== 'admin');
        loginTab.onclick = () => { isLogin = true; loginTab.classList.add('active'); signupTab.classList.remove('active'); document.getElementById('regName').classList.add('hidden'); };
        signupTab.onclick = () => { isLogin = false; signupTab.classList.add('active'); loginTab.classList.remove('active'); document.getElementById('regName').classList.remove('hidden'); };

        document.getElementById('auth-form').onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            if(isLogin) {
                if(roleSelect.value === 'admin' && adminKeyField.value !== "ADMIN123") return alert("Wrong Admin Key!");
                signInWithEmailAndPassword(auth, email, pass).catch(err => alert(err.message));
            } else {
                createUserWithEmailAndPassword(auth, email, pass).then(() => alert("Account Created!")).catch(err => alert(err.message));
            }
        };

        // --- LOGOUT FUNCTION ---
        window.logout = () => {
            signOut(auth).then(() => {
                location.reload();
            });
        };

        // --- ADMIN UPLOAD ---
        document.getElementById('uploadBtn').onclick = async () => {
            const file = document.getElementById('fileInput').files[0];
            const subj = document.getElementById('upSubj').value;
            if(!file || !subj) return alert("Fill all fields!");

            const storageRef = ref(storage, `pyqs/${Date.now()}_${file.name}`);
            try {
                const snap = await uploadBytes(storageRef, file);
                const url = await getDownloadURL(snap.ref);
                await addDoc(collection(db, "pyqs"), { 
                    subject: subj, year: document.getElementById('upYear').value, 
                    sem: document.getElementById('upSem').value, fileUrl: url, time: serverTimestamp() 
                });
                alert("File Uploaded Successfully!");
            } catch (err) { alert(err.message); }
        };

        // --- STUDENT PYQ GALLERY ---
        document.getElementById('viewPyqBtn').onclick = async () => {
            const content = document.getElementById('main-content');
            content.innerHTML = "<h2>Loading Library...</h2>";
            const snap = await getDocs(query(collection(db, "pyqs"), orderBy("time", "desc")));
            
            let html = `<h2>PYQ Library</h2><div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:15px; margin-top:20px;">`;
            snap.forEach(doc => {
                const d = doc.data();
                html += `<div class="card" style="margin:0; border-top:5px solid var(--primary)">
                    <h4>${d.subject}</h4><p>Year: ${d.year}</p><p>${d.sem}</p>
                    <a href="${d.fileUrl}" target="_blank" class="btn-main" style="display:block; text-align:center; text-decoration:none;">Open PDF/Image</a>
                </div>`;
            });
            html += `</div><button class="btn-main" onclick="location.reload()" style="background:#64748b; margin-top:20px;">Back to Home</button>`;
            content.innerHTML = html;
        };

        // --- REVIEWS ---
        document.getElementById('postReview').onclick = async () => {
            const text = document.getElementById('reviewInput').value;
            if(!text) return;
            await addDoc(collection(db, "reviews"), { text, user: auth.currentUser.email, time: serverTimestamp() });
            document.getElementById('reviewInput').value = "";
        };

        onSnapshot(query(collection(db, "reviews"), orderBy("time", "desc")), (snap) => {
            const box = document.getElementById('reviewBox');
            box.innerHTML = "";
            snap.forEach(doc => {
                box.innerHTML += `<div class="review-item"><strong>${doc.data().user.split('@')[0]}</strong>: ${doc.data().text}</div>`;
            });
        });

        // --- AUTH WATCHER ---
        onAuthStateChanged(auth, (user) => {
            if(user) {
                document.getElementById('auth-page').classList.add('hidden');
                if(roleSelect.value === 'admin') {
                    document.getElementById('admin-panel').classList.remove('hidden');
                } else {
                    document.getElementById('dashboard').classList.remove('hidden');
                    document.getElementById('userNameDisplay').innerText = `Hello, ${user.email.split('@')[0]}!`;
                    document.getElementById('dateDisplay').innerText = new Date().toDateString();
                    document.getElementById('quoteDisplay').innerText = `"Learning never exhausts the mind."`;
                }
            }
        });
    </script>
</body>
</html>
